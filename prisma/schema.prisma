// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// 1. MAIN PRODUCT MODEL
model Product {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  
  // --- IDENTIFICATION ---
  name           String   // Internal ID/Name (e.g. "anchor-wedge-m6")
  title          String   // Display Title (e.g. "M6 Wedge Anchor")
  slug           String   @unique
  description    String

  // --- HIERARCHY (3 Levels) ---
  category       String   // Level 1: e.g., "fastening"
  subCategory    String?  // Level 2: e.g., "anchors"
  subSubCategory String?  // Level 3: e.g., "wedge-anchors" <--- NEW FIELD

  // --- IMAGES ---
  image          String   // Main Display Image (URL or Path)
  imagePath      String?  // Internal Path (Backup for local uploads)
  gallery        String[] // Array of strings for extra images
  
  // --- PRICE & INVENTORY ---
  price          Float    @default(0.0)
  quantity       Int      @default(10)
  sku            String?  @unique // Stock Keeping Unit (e.g. "ANC-WDG-M6")
  
  // --- HARDWARE SPECIFICS ---
  // Store things like { "material": "SS304", "size": "M6x50", "thread": "Standard" }
  specs          Json?    
  brand          String?
  
  // --- STATUS ---
  isPublished    Boolean  @default(true)
  isFeatured     Boolean  @default(false)

  // --- RELATIONS ---
  variants       Variant[]
  
  // --- TIMESTAMPS ---
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

// 2. VARIANT MODEL (For sizes/options of the same product)
model Variant {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String   // e.g. "Pack of 50" or "Length 20mm"
  price       Float
  stock       Int      @default(0)
  sku         String?
  
  // Relation back to Product
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId   String   @db.ObjectId
}